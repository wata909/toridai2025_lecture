<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>回転する地球デモ</title>
  <!-- 注意: ファイルを直接 file:// で開くと fetch が失敗します。HTTP サーバー経由で開いてください -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/topojson-client@3"></script>
  <style>
    body { margin: 0; overflow: hidden; background-color: #000; }
    canvas { display: block; }
  </style>
</head>
<body>
  <canvas id="globe"></canvas>
  <script>
    // このデモは HTTP(S) サーバー経由で動作します
    // ローカルで試す場合: ターミナルで "python -m http.server" などを実行し、http://localhost:8000/ にアクセス

    // canvas 初期化
    const canvas = document.getElementById('globe');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    const context = canvas.getContext('2d');

    // 投影設定
    const projection = d3.geoOrthographic()
      .scale(window.innerHeight / 2.1)
      .translate([window.innerWidth / 2, window.innerHeight / 2])
      .clipAngle(90);
    const path = d3.geoPath().projection(projection).context(context);
    const graticule = d3.geoGraticule();

    // 地物データ読み込み
    d3.json('https://www.jasondavies.com/maps/world-110m.json')
      .then(world => {
        const land = topojson.feature(world, world.objects.land);
        d3.timer(elapsed => {
          projection.rotate([elapsed * 0.02, -15]);
          context.clearRect(0, 0, canvas.width, canvas.height);
          // 海球体
          context.beginPath(); path({ type: 'Sphere' }); context.fillStyle = '#203050'; context.fill();
          // 陸地
          context.beginPath(); path(land); context.fillStyle = '#0a0'; context.fill();
          // 経緯線
          context.beginPath(); path(graticule()); context.strokeStyle = 'rgba(255,255,255,0.2)'; context.lineWidth = 0.5; context.stroke();
        });
      })
      .catch(err => console.error('データ読み込みエラー:', err));
  </script>
</body>
</html>

